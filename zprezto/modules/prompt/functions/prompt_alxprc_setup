#
# A theme, yo.
#
# Authors:
#   Alex Pearce <alex@alexpearce.me>
#

pmodload 'helper'

function prompt_alxprc_precmd {
  setopt LOCAL_OPTIONS
  unsetopt XTRACE KSH_ARRAYS

  # Get git information
  if (( $+functions[git-info] )); then
    git-info
  fi
  # Get virtualenv information
  if (( $+functions[python-info] )); then
    python-info
  fi
}

function prompt_alxprc_setup {
  setopt LOCAL_OPTIONS
  unsetopt XTRACE KSH_ARRAYS
  prompt_opts=(cr percent subst)

  autoload -Uz add-zsh-hook

  add-zsh-hook precmd prompt_alxprc_precmd

  # Virtualenv prompt styling
  zstyle ':prezto:module:python:info:virtualenv' format '%F{242}%v%f '

  # Git prompt styling
  zstyle ':prezto:module:git:info' verbose 'yes'
  zstyle ':prezto:module:git:info:ahead' format ' %F{yellow}⇡%f'
  zstyle ':prezto:module:git:info:behind' format ' %F{yellow}⇣%f'
  zstyle ':prezto:module:git:info:branch' format '%F{242}%b%f'
  zstyle ':prezto:module:git:info:modified' format '%F{magenta}*%f'
  zstyle ':prezto:module:git:info:stashed' format '%{red}^%f'
  zstyle ':prezto:module:git:info:keys' format \
    'prompt'  '%b%m%S%A%B%c ' \
    'rprompt' ''

  # Define prompts
  PROMPT='
${SSH_TTY:+"%F{red}%n%f@%F{magenta}%m%f "}%F{blue}%~%f ${git_info[prompt]}
%B>%b '
  RPROMPT='${python_info[virtualenv]}'
  SPROMPT='zsh: correct %F{red}%R%f to %F{green}%r%f [nyae]? '
}

prompt_alxprc_setup "$@"
